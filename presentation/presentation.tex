\documentclass{beamer}
\usepackage{graphicx}
\usepackage[utf8]{inputenc}
\usepackage{biblatex}
\usepackage{marvosym}
\usepackage{booktabs}
\usepackage{multicol}
\usepackage{tabularx}
\setbeamercovered{transparent=15}
\addbibresource{../bibliography.bib}

\setbeamerfont{institute}{size=\large}
\setbeamerfont{date}{size=\small}

\newcommand\red[1]{\textcolor{red}{#1}}

\usetheme{Madrid}
\usecolortheme{orchid}

%\AtBeginSection[]{
%  \begin{frame}
%  \vfill
%  \centering
%  \begin{beamercolorbox}[sep=8pt,center,shadow=true,rounded=true]{title}
%    \usebeamerfont{title}\insertsectionhead\par%
%  \end{beamercolorbox}
%  \vfill
%  \end{frame}
%}
\AtBeginSubsection[]{
  \begin{frame}[allowframebreaks,noframenumbering]
    \frametitle{\contentsname}
    \begin{multicols}{2}
        \tableofcontents[currentsection,currentsubsection]
    \end{multicols}
  \end{frame}
}


\title{Blockchain and Bitcoin}
\subtitle[]{Overview of Blockchain technology and cryptocurrencies, focusing on
the Bitcoin protocol and its scalability and privacy aspects}
\institute[]{Università degli studi di Brescia}
\author{Michele Zanotti}
\date{\today}

\begin{document}
  \begin{frame}
    \titlepage
  \end{frame}
  \begin{frame}{Summary}
    \frametitle{\contentsname}
    \begin{multicols}{2}
        \tableofcontents
    \end{multicols}
  \end{frame}





  %%%%%%%%%%%%%%%%%%%%%
  %%% SECOND SECTION %%%
  %%%%%%%%%%%%%%%%%%%%%
  \section{Introduction to Blockchain}
  \subsection{Preliminary concepts}
 % \begin{frame}{Introduction}
 %   \framesubtitle{Distributed systems}
 %   \begin{columns}[onlytextwidth]
 %     \column{.5\textwidth} \begin{block}{Distributed system}
 %       A \textcolor{red}{distributed system} is a network that %consists of autonomous nodes,
 %       connected using a distribution middleware, which acts in %a coordinated way
 %       (passing messages to each other) in order to achieve a %common outcome and
 %       that can be seen by the user as a single logical %platform.
 %     \end{block}

  %    \column{.5\textwidth}
  %    \begin{figure}[!htb]
  %      \centering
  %      \includegraphics[width=0.7\linewidth]{../img/distributed-%system.png}
  %    \end{figure}
  %  \end{columns}
  %\end{frame}




%  \begin{frame}{Introduction}
%    \framesubtitle{Distributed systems}
%      The desired properties of a distributed system are the %following:\vspace{10pt}
%      \begin{itemize}
%        \item \textbf{Consistency}: all the nodes have the same %lates available copy of the data.
%        \item \textbf{Availability}: the system is always working %and responding to the
%        input requests without any failures.
%        \item \textbf{Partition tolerance}: if a group of nodes %fails the distributed system
%        still continues to operate correctly
%      \end{itemize}
%  \end{frame}


\begin{frame}{Introduction}
    \begin{block}{Distributed system}
    A \textcolor{red}{distributed system} is a network that consists of autonomous nodes,
    connected using a distribution middleware, which acts in a coordinated way
    (passing messages to each other) in order to achieve a common outcome and
    that can be seen by the user as a single logical platform.
    \end{block}
\end{frame}


  \begin{frame}{Introduction}
    Even if some of the nodes fault or links break, a distributed system should tolerate
    this and should continue to work correctly. There are two types of fault:
    \begin{itemize}
      \item Simple node crash
      \item Exhibition of malicious or inconsistent behavior arbitrarily: \red{Byzantine fault}
    \end{itemize}

    \pause 
    \begin{block}{Byzantine nodes}
      A \textcolor{red}{Byzantine node} is a node that has an arbitrary behavior,
      which can even be malicious.
    \end{block}
  \end{frame}
  
  
  
  
  \begin{frame}{Introduction}
        \begin{block}{The Byzantine generals problem}
          \begin{itemize}
            \item Problem formulated by Leslie Lamport \cite{lamport1982byzantine}
            \item A group of generals are surrounding a city and they have to agree
            on a common decision: attack or retreat.
            \item Their only communication way is a messenger
            \item Some of the generals may be \emph{traitors}: they communicate
            misleading message for preventing the loyal generals from reaching an
            agreement
            \item Requirement: algorithm that allows the loyal generals to agree
            on the same plan regardless of traitors general
          \end{itemize}
        \end{block}
    \end{frame}

    \begin{frame}{Introduction}
        \begin{figure}[!htb]
                \centering
                \includegraphics[width=0.5\linewidth]{../img/byzantine.jpg}
        \end{figure}
        \begin{figure}
            \centering
            \includegraphics[width=0.7\linewidth]{../img/byzantine-generals-problem.png}
        \end{figure}
    \end{frame}




  \begin{frame}{Introduction}
    \begin{block}{Consensus}
      \red{Consensus} is the process of agreement between untrusted nodes on a data
      value.
    \end{block}

    \pause
    Requirements for a consensus algorithm:
    \begin{itemize}
      \item \textbf{Agreement}: non-byzantine nodes must agree on the same value
      \item \textbf{Termination}: the consensus process must come to an end (nodes
      have to reach a decision)
      \item \textbf{Validity}: the agreed value must have been proposed by at
      least one honest node
      \item \textbf{Fault tolerance}: the consensus algorithm must work even
      in the presence of one or more Byzantine nodes
    \end{itemize}
  \end{frame}

  
  
  
  \subsection{Definition}
  \begin{frame}{What is Blockchain}
    \begin{block}{Business definition}
      Blockchain is a platform whereby peers can exchange values without the need
      for a central trusted party by using transactions which are stored inside
      the platform in a verifiable and permanent way.
    \end{block}
    
    \pause
    \begin{block}{Technical definition}
      Blockchain is a distributed ledger that is
      \begin{itemize}
        \item cryptographically secure
        \item append-only
        \item immutable (extremely hard to change)
        \item updateable only via consensus among nodes
      \end{itemize}
    \end{block}
  \end{frame}



  \subsection{Features}
  \begin{frame}{Blockchain features}
    \begin{itemize}
      \item \textbf{Decentralization}: no need of a central trusted entity
      which stores the data and validates the transaction \pause
      \item \textbf{Distributed consensus}: high Byzantine Fault
      Tolerance, for each data value there's only a single version agreed by all
      parties through a consensus algorithm \pause
      \item \textbf{High availability}: Blockchain is based on a peer-to-peer
      network and data replicated on each node: even if one or more nodes fail
      the whole network can continue to work correctly
    \end{itemize}
  \end{frame}

  \begin{frame}{Blockchain features (Cont.)}
    \begin{itemize}
      \item \textbf{Immutability}: once a block has been added to the blockchain,
      changing it is computationally infeasible \pause
      \item \textbf{Transparency}: every node can see what is in the blockchain \pause
      \item \textbf{Security}: integrity of data, authentication and non-repudiation
      are ensured. Confidentiality is not provided. Security is a consequence of
      the distributed nature of Blockchain \pause
      \item \textbf{Uniqueness}: every transaction is unique and has not been spent already
    \end{itemize}
  \end{frame}



  \subsection{Structure}
  \begin{frame}{Blockchain structure}
    \begin{itemize}
      \item Linked list of ordered fixed-length \red{blocks}
      \item Each block includes a set of \red{transactions}
    \end{itemize}

    \begin{figure}[!htb]
      \centering
      \includegraphics[width=0.45\linewidth]{../img/blockchain-basic-schema.png}
    \end{figure}
  \end{frame}




  \begin{frame}{Blockchain structure}
    \framesubtitle{Blocks structure}
        \begin{figure}[!htb]
          \centering
          \includegraphics[width=0.3\linewidth]{../img/blockchain-basic-schema.png}
        \end{figure}
      \begin{itemize}
        \item  A block is a group of transactions. Generally, it is composed of:
        \begin{itemize}
          \item[-] a set of transactions
          \item[-] a hash which identifies the block
          \item[-] a pointer to the previous block hash
          \item[-] a nonce
          \item[-] a timestamp
        \end{itemize}
        \item The first block in the blockchain is called \red{genesis block}.
      \end{itemize}
  \end{frame}




  \begin{frame}{Blockchain structure}
    \framesubtitle{Nodes, addresses and transactions}
    \begin{itemize}
      \item \textbf{Nodes} are active entities which store a copy of the blockchain and can
      perform and/or validate transactions \pause
      \item \textbf{Addresses} are unique identifiers which identify the parties involved in a
      transaction and usually are a public key or are derived from a public key. \pause
      \item \textbf{Transactions} are transfers of value from an address to another. \pause
      \item \textbf{Transaction scripts} are predefined sets of commands for nodes to transfer
      values from one address to another and perform various other functions.
    \end{itemize}
  \end{frame}



  \subsection{Consensus}
  \begin{frame}{Consensus in Blockchain}
      \begin{itemize}
        \item Required to establish whether the ledger itself or new blocks are
        valid or not
        \item Analogy with the Byzantine Generals Problem:
        \begin{itemize}
            \item[-]``generals'' are the nodes of the Blockchain
            \item[-]``messengers'' are the network links
            \item[-]``traitors'' are malicious nodes which try to tamper with the data
        \end{itemize} 
      \end{itemize}
  \end{frame}
  
  
  
  \begin{frame}{Consensus in Blockchain}
      Consensus mechanisms commonly used in Blockchain:
      \begin{enumerate}
        \item Practical Byzantine Fault Tolerance (\textbf{PBFT})
        \item Proof of Work (\textbf{PoW})
        \item Proof of Stake (\textbf{PoS})
        \item Delegated Proof of Stake (\textbf{DPoS})
      \end{enumerate}
  \end{frame}




  \begin{frame}{Consensus in Blockchain}
    \framesubtitle{Common Consensus mechanisms}
    \begin{block}{1) Practical Byzantine Fault Tolerance}
      \begin{itemize}
        \item Algorithm proposed by M. Castro and B. Liskov as an optimized
        solution to the Byzantine Generals Problem \cite{castro1999practical} 
        \item Each “general” maintains an internal state. When he receives a
        message, he uses it in conjunction with his internal state to
        run a computation which tells what to think about the message in question 
        \item  After reaching his individual decision about the message,
        the general shares that decision with all the other “generals” in the system 
        \item  A consensus decision is determined based on the total decisions
        submitted by all generals \pause
        \item \textcolor{green}{Pro}: very efficient \pause
        \item \red{Cons}: precludes users anonymity \pause
        \item Mechanism adopted by Hyperledger and Ripple
      \end{itemize}
    \end{block}
  \end{frame}




  \begin{frame}{Consensus in Blockchain}
    \framesubtitle{Common Consensus mechanisms}
    \begin{block}{2) Proof of Work}
      \begin{itemize}
        \item Contrary to the PBFT, it doesn’t require all nodes to submit
        their individual conclusions 
        \item Based on a proof that ensures that enough computational resources have
        been spent before proposing a block for acceptance by the network 
        \item Only a single node (the first one who solves the PoW) announces its
        block 
        \item The announced blocks can be independently verified by all
        the nodes in the system \pause
        \item Mechanism adopted by Bitcoin
      \end{itemize}
    \end{block}
  \end{frame}





  \begin{frame}{Consensus in Blockchain}
    \framesubtitle{Common Consensus mechanisms}
    \begin{block}{3) Proof of Stake}
      \begin{itemize}
        \item Contrary to PoW, there isn't any individual attempting to carry out
        an intensive computation in order to propose a block 
        \item The network runs a lottery based on the nodes’ stake to decide
        who will announce a block 
        \item The more stake one node has, the higher the probability
        to be chosen is 
        \item \textcolor{green}{Main idea}: if a node that has enough stake in the system it means
        that it has invested enough in the system \MVRightarrow\, any malicious
        attempt/attack on the system wouldn't have any benefits for him \pause
        \item \red{Main problem}: the system rewards more those who already are most
        deeply involved in the network \MVRightarrow\, the system becomes always
        more centralized
      \end{itemize}
    \end{block}
  \end{frame}





  \begin{frame}{Consensus in Blockchain}
    \framesubtitle{Common Consensus mechanisms}
    \begin{block}{4) Delegated Proof of Stake}
      \begin{itemize}
        \item Evolution of the PoS 
        \item Each node that has stake in the system can choose an entity to
        represent its portion of stake in the system (by voting) 
        \item The more stake one node has, the higher is the weight of his vote 
        \item The entity with most votes (weighted) becomes a delegate which
        proposes blocks 
        \item The voting process is periodically executed: if the current delegate
        doesn't behave correctly the other nodes just stop voting it
      \end{itemize}
    \end{block}
  \end{frame}



  \subsection{Types of Blockchain}
  \begin{frame}{Types of Blockchain}
    \begin{block}{1) Public Blockchain}
      \begin{itemize}
        \item Blockchain open to the public in which everyone can join the network,
        maintain the shared ledger and participate in the consensus process 
        \item The ledger is not owned by anyone and everyone can read it 
        \item Usually there's an incentive mechanism to encourage more participants
        to join the network \pause
        \item \red{Main problem}: lack of privacy (everyone can see the transactions
        stored in the blockchain) \pause
        \item Bitcoin is based on a public blockchain
      \end{itemize}
    \end{block}
  \end{frame}




  \begin{frame}{Types of Blockchain (Cont. 1)}
    \begin{block}{2) Private Blockchain}
      \begin{itemize}
        \item Open only to an organization or a group of individuals
        \item Participants need to obtain an invitation or permission to join the Blockchain and maintain the ledger
        \item Usually the network is permissioned: restrictions on who is allowed to participate in the network and only in certain transactions 
        \item Example of private Blockchain: Hyperledger Fabric \cite{hyperledger-fabric}
      \end{itemize}
    \end{block}
  \end{frame}




  \begin{frame}{Types of Blockchain (Cont. 2)}
    \begin{block}{3) Consortium Blockchain}
      \begin{itemize}
        \item Consensus process is controlled by a preselected set of nodes (e.g. a consortium of organizations, each of which operates a node) 
        \item The right to read the blockchain might be public or permissioned 
        \item Example of consortium Blockchain: R3 \cite{R3}
      \end{itemize}
    \end{block}
  \end{frame}










  %%%%%%%%%%%%%%%%%%%%%
  %%% THIRD SECTION %%%
  %%%%%%%%%%%%%%%%%%%%%
  \section{Bitcoin}
  \subsection{What is Bitcoin}
  \begin{frame}{What is Bitcoin}
    \begin{itemize}
      \item First fully decentralized cryptocurrency 
      \item Invented by Satoshi Nakamoto in 2008: first real implementation of
      Blockchain 
      \item Bitcoin can be either defined as a protocol, a digital currency
      and a platform: 
      \begin{itemize}
        \item Bitcoin (capital B)  \MVRightarrow\, Bitcoin protocol
        \item bitcoin (lowercase b) \MVRightarrow\, bitcoin  currency
      \end{itemize} \pause
    \end{itemize}

    \begin{block}{The reference implementation}
      \begin{itemize}
        \item Bitcoin is an open source project and is developed by a community of volunteers
        \item The reference implementation is \textbf{Bitcoin Core}
        \item It is considered the authoritative implementation and it specifies
        how each part of the system has to be implemented.
      \end{itemize}
    \end{block}
  \end{frame}




  \begin{frame}{What is Bitcoin (Cont. 1)}
    Bitcoin can be seen as a combination of:
    \begin{itemize}
      \item a decentralized peer-to-peer-network (the Bitcoin protocol)
      \item a public transaction ledger (the blockchain) 
      \item a set of rules for validating transactions (consensus rules) 
      \item a mechanism for reaching distributed consensus on the blockchain
      (distributed consensus algorithm) 
    \end{itemize}
  \end{frame}





  \begin{frame}{What is Bitcoin (Cont. 2)}
    Bitcoins are entirely ``virtual'':
    \begin{itemize}
      \item there aren't any physical or virtual coins stored anywhere 
      \item the coins are implied in the transactions that send value from a sender to
      a receiver
    \end{itemize}
  \end{frame}





  \subsection{Scripts}
  \begin{frame}{Bitcoin scripts}
    \begin{itemize}
      \item Script = list of instructions recorded with each transaction that describes
      how the next person wanting to spend the Bitcoins being transferred can gain access to them \pause 
      \item Programming language used: ``\red{Script}'' \cite{script-bitcoin-wiki} 
      \begin{itemize}
        \item very simple programming language 
        \item not Turing-complete {\tiny(no loops and no complex control flow instructions)} 
        \item deliberately disegned like this for avoiding abuses of the scripts
        for conducting denial of service attacks {\tiny(each scripts has to be
        executed on each node of the network)}
      \end{itemize}
    \end{itemize}
  \end{frame}




  \subsection{Keys and addresses}
  \begin{frame}{Keys and addresses}
    \begin{itemize}
      \item Ownership of bitcoins is established through:
      \begin{itemize}
          \item digital keys
          \item Bitcoin addresses
          \item digital signatures
      \end{itemize} 
      \item In order to be included in the blockchain, transactions require a valid
      signature which can be generated only with a private (secret) key 
      \item The private key proves the ownership of bitcoins by signing transactions and
      transferring value from a user to another \pause
    \end{itemize}
    \begin{block}{Analogy with traditional banking}
      \begin{itemize}
        \item public key \MVRightarrow\, bank account number
        \item private key \MVRightarrow\, secret PIN (or signature on a check)
        which which allows to unlock the value and transferring it to other people
      \end{itemize}
    \end{block}
  \end{frame}





  \begin{frame}{Keys and addresses (Cont. 1)}
    \begin{block}{Addresses}
      \begin{itemize}
        \item unique strings of digits and characters which identify the originator and/or the destination of a transaction \pause
        \item derived from public keys through one-way cryptographic hashing:
        \begin{enumerate}
          \item Double hashing: SHA-256 + RIPEMD160
          \item 160-bit hash as result
          \item Base58Check encoding of the 160-bit hash
          \item Result: 26-35 characters string which begins with “1” (\red{public key
          address}) or “3” (\red{pay-to-script-hash address})
        \end{enumerate}
      \end{itemize}
    \end{block}
  \end{frame}





  \begin{frame}{Keys and addresses (Cont. 2)}
    \begin{block}{Keys}
      \begin{itemize}
        \item Private keys are 256-bit random numbers and can be represented
        in different formats \pause
        \item Public keys are generated starting from the private keys using
        elliptic curve multiplication: \pause
        \begin{itemize}
          \item ``Trap door'' function 
          \item Elliptic curve  specified by the secp256k1 standard, defined by the NIST:
          \[ y^2 \bmod p = (x^3 + 7) \bmod p \]
          where $p = 2^{256} – 2^{32} – 2^9 – 2^8 – 2^7 – 2^6 – 2^4 – 1$ is a very large prime number 
          \item Public key $K=k*G$, where $k$ is the private key and $G$ is
          a point on the curve defined by the standard 
          \item The generator point $G$ is always the same for all Bitcoin users
        \end{itemize}
      \end{itemize}
    \end{block}
  \end{frame}





  \begin{frame}{Keys and addresses (Cont. 3)}
    \begin{block}{Public key formats}
      \begin{itemize}
        \item \textbf{Uncompressed format}: the key is the coordinates pair
        $(x,y)$ of a point on the curve \MVRightarrow\, prefix $04$ followed by
        two 256-bit numbers (65 Bytes) \pause
        \item \textbf{Compressed format}: prefix $03$ (if the y-coordinate is an
        odd number) or $02$ (if the y-coordinate is an even number) followed
        by the x-coordinate \MVRightarrow\ 33 Bytes.
        \begin{itemize}
          \item the y-coordinate can be derived from the x one \pause
        \end{itemize}
        \item Address derived from a compressed public key $\neq$ address derived
        from the uncompressed version \pause
        \begin{itemize}
          \item solution: \textbf{compressed private keys}
          \item private keys from which only compressed
          public keys should be derived
        \end{itemize}
      \end{itemize}
    \end{block}
  \end{frame}




  \subsection{Transactions}
  \begin{frame}{Transactions}
    \begin{itemize}
      \item Data structures that encode the transfer of value between participants
      in the bitcoin system 
      \item They're public visible by anyone 
      \item A transaction includes at least one input and output
    \end{itemize}
  \end{frame}





  \begin{frame}{Transactions (Cont. 1)}
    \begin{block}{Transaction outputs}
      \begin{itemize}
        \item Consist of two parts:
        \begin{enumerate}
          \item amount of bitcoin (discrete and indivisible, expressed in Satoshi)
          \item set of conditions required for spending the output (\textbf{locking script})
        \end{enumerate}
        \pause
        \item All the available and spendable outputs are stored in the blockchain
        and they are called unspent transaction outputs (\textbf{UTXO}) 
        \item Wallet balance = e aggregated value of all the UTXOs the user can spend with the keys it controls 
        \item UXTO can only be spent in its entirety 
        \begin{itemize}
          \item[$\rightarrow$] usually transactions generate \emph{change}
        \end{itemize}
      \end{itemize}
    \end{block}
  \end{frame}





  \begin{frame}{Transactions (Cont. 2)}
    \begin{block}{Transaction inputs}
      A transaction input consists of: 
      \begin{enumerate}
        \item one or more UTXOs that will be consumed 
        \item a proof of ownership through the locking script to unlock the selected UXTO 
        \begin{itemize}
          \item[$\rightarrow$] usually consists of a digital signature and a public key
        \end{itemize}
      \end{enumerate}
    \end{block}
  \end{frame}
  
  
  
  
  \begin{frame}{Transactions (Cont. 3)}
    \begin{block}{Example of transaction}
        \textbf{Input}\\
        \begin{itemize}
            \item Previous tx: \begin{tiny}f5d8ee39a430901c91a5917b9f2dc19d6d1a0e9cea205b009ca73dd04470b9a6\end{tiny}
            \item Index: 0
            \item scriptSig: 
            \begin{enumerate}
                \item \begin{tiny}304502206e21798a42fae0e854281abd38bacd1aeed3ee3738d9e1446618c4571d10\end{tiny}
                \item \begin{tiny}90db022100e2ac980643b0b82c0e88ffdfec6b64e3e6ba35e7ba5fdd7d5d6cc8d25c6b241501\end{tiny}
            \end{enumerate}
        \end{itemize}

        \textbf{Output}\\
        \begin{itemize}
            \item Value: 5000000000
            \item scriptPubKey: OP\_DUP OP\_HASH160 \begin{tiny}i404371705fa9bd789a2fcd52d2c580b65d35549d\end{tiny}\\ OP\_EQUALVERIFY OP\_CHECKSIG
        \end{itemize}
    \end{block}
  \end{frame}
  
  
  
  
%  \begin{frame}{Transactions (Cont. 4)}
%      \begin{figure}
%          \centering
%          \includegraphics[width=0.8\linewidth]{../img/Transaction.png}
%      \end{figure}
%  \end{frame}





%  \begin{frame}{Transactions (Cont. 3)}
%    \begin{block}{Transaction typical life cycle}
%      \begin{enumerate}
%        \item A sender sends a transaction (using a wallet application) 
%        \item The wallet signs the transaction using the sender’s private %key in order
%        to prove the ownership of the value being transferred 
%        \item The transaction is broadcasted to the Bitcoin network 
%        \item Mining nodes include this transaction in the next block to %be mined 
%        \item When a node solves the Proof of Work it broadcasts the
%        newly block to the network 
%        \item Confirmation process starts: each node verifies the new %block and propagate it further
%      \end{enumerate}
%    \end{block}
%  \end{frame}

  \begin{frame}{Transactions (Cont. 4)}
    \begin{block}{Transaction fees}
      \begin{itemize}
        \item Two purposes:
        \begin{enumerate}
          \item Compensate the miners 
          \item Act as a security mechanism: economically infeasible for attackers to flood the network with transactions 
        \end{enumerate}
        \item Their value depends on the size of the transaction:
        \[ Fees = Sum(Inputs)–Sum(Outputs) \] 
        \item The spender is the one that decides how much fee to pay
        \begin{itemize}
            \item the miners choose from a pool the transactions to include in the next block
            \item higher fee = faster confirmation (mined quicker)
            \item null fee = the transaction will likely never be mined
        \end{itemize}
      \end{itemize}
    \end{block}
  \end{frame}





  \begin{frame}{Transactions (Cont. 5)}
    \begin{block}{Coinbase transactions}
      \begin{itemize}
        \item First transaction in a block 
        \item Created by the first node which solves the proof-of-work 
        \item Create brand-new bitcoins that the miner can spend as a reward for mining
        \item Do not consume UTXO: they have special type of input called coinbase
      \end{itemize}
    \end{block}
  \end{frame}





  \subsection{Wallets}
  \begin{frame}{Wallets}
    \begin{itemize}
      \item Applications that serve as a user interface and manage user’s money 
      \item Technically: data structures that securely store the user’s private keys required for spending the bitcoins he possesses 
      \item They don't store ``money'' but only pairs of public/private keys
      \item Two kind of wallets: \emph{deterministic} and \emph{nondeterministic}
    \end{itemize}
  \end{frame}




  \begin{frame}{Wallets (Cont. 1)}
    \begin{block}{Nondeterministic wallets}
      \begin{itemize}
        \item Each key is independently generated starting from a random number \MVRightarrow\, keys stored in the wallet are not related to each other \
        \item Main disadvantage: cumbersome to manage 
        \begin{itemize}
          \item[-] they have to be backed up frequently \MVRightarrow\, each key has to be backed up 
          \item[-] address reuse avoidance \MVRightarrow\, many addresses \MVRightarrow\, many keys that has to be backed up frequently
        \end{itemize}
      \end{itemize}
    \end{block}
  \end{frame}




  \begin{frame}{Wallets (Cont. 2)}
    \begin{block}{Deterministic wallets}
      \begin{itemize}
        \item All the keys are derived from a single master key (the \emph{seed}) 
        \item The stored keys can be generated again if one has the original seed 
        \item Only the seed has to be backed up 
        \item Easily manageable, even if using address reuse avoidance 
        \item Keys usually derived in a tree structure (BIP-32 standard) 
        \begin{itemize}
            \item high flexibility
        \end{itemize}
        \item Seeds usually created according to BIP-39 standard 
        \begin{itemize}
          \item[-] sequence of English words called \emph{mnemonic} 
          \item[-] easy to transcribe, export and import across wallets
        \end{itemize}
      \end{itemize}
    \end{block}
  \end{frame}




  \subsection{Bitcoin Blockchain}
  \begin{frame}{Bitcoin Blockchain}
     \begin{itemize}
         \item Linked list of blocks of transactions
         \item Each block is identified by a SHA-256 hash
         \item Each blocks embeds in its header the hash of the previous block
         \begin{itemize}
             \item changing a block causes its hash to change
             \item the hash of the children blocks changes as well (cascade effect)
         \end{itemize}
         \item Once a block has enough children, it cannot be changed without recalculating all the subsequent blocks
         \begin{itemize}
             \item[\MVRightarrow] blockchain history is practically immutable
         \end{itemize}
     \end{itemize}
  \end{frame}
  
  
  
  \begin{frame}{Bitcoin Blockchain}
    \begin{figure}[!htb]
    \centering
    \includegraphics[width=0.45\linewidth]{../img/bitcoin-blockchain-scheme.png}
    \end{figure}
  \end{frame}
  
  
  
  \begin{frame}{Bitcoin Blockchain}
      \begin{block}{Merkle Trees}
          \begin{itemize}
              \item Data structure used for summarize and verify the integrity of large sets of data in an efficient way (Binary tree of hashes)
              \item Used for efficiently verify if a transaction is included in a block
              \item The root of the tree stored in each block summarizes all the transactions included in that block
              \begin{itemize}
                  \item [\MVRightarrow] nodes can verify transactions without downloading all the block transactions (but just a Merkle path + block header)
              \end{itemize} 
          \end{itemize}
      \end{block}
  \end{frame}
  
  
  
  \begin{frame}{Bitcoin Blockchain}
    \framesubtitle{Merkle Trees}
    \begin{figure}
      \includegraphics[width=0.6\linewidth]{../img/merkle-tree-path.png}
    \end{figure}
    \begin{itemize}
        \item To check if a transaction is included in a block, only $log_2(N)$ hashes have to be downloaded ($N$ number of transactions of the block)
    \end{itemize}
  \end{frame}
  
  
  
  
  
  \begin{frame}{Bitcoin Blockchain}
  \framesubtitle{Merkle Trees}
      \footnotesize
       \begin{tabularx}{\textwidth}{l l l l}
         \toprule
         \textbf{Number of transactions}	& \textbf{Approx size of block} & \textbf{Path size} &	\textbf{Path size}   \\ \midrule
         16 transactions & 4 kilobytes & 4 hashes & 128 bytes \\
         \\
         512 transactions & 128 kilobytes & 9 hashes & 288 bytes \\
         \\
         2048 transactions & 512 kilobytes & 11 hashes & 352 bytes \\
         \\
         65535 transactions & 16 megabytes & 16 hashes & 512 bytes \\
         \bottomrule
     \end{tabularx}
  \end{frame}
  
  
  
  
  \subsection{Bitcoin Network}
  \begin{frame}{Bitcoin Network}
    The network is a peer-to-peer network
    \begin{itemize}
        \item no ``special'' nodes (all the nodes consume and provide services) 
        \item flat network topology
        \item nodes connected in a mesh (each node connected only to few peers)
        \begin{itemize}
            \item[\MVRightarrow] DoS attack prevention % otherwise a node could broadcast many bad-formed blocks/transactions
        \end{itemize}
    \end{itemize}
    
    Three different types of nodes:
    \begin{enumerate}
        \item Full nodes
        \item Miners
        \item Lightweight clients
    \end{enumerate}
    
    %Despite the type, all the nodes validate and propagate blocks
  \end{frame}
  
  
  
  
  \begin{frame}{Bitcoin Network}
    \framesubtitle{Node types}
    \begin{block}{1) Full nodes}
        \begin{itemize}
            \item Maintain a full copy of the Blockchain
            \begin{itemize}
                \item[\MVRightarrow] they can autonomously and authoritatively verify transactions (they can build the UTXO set)
            \end{itemize}
            \item Validate and forward transactions/blocks to their peers 
            \item \textcolor{red}{Drawback}: the size of the Blockchain is currently around 178 GB \cite{statista}
            \item \textcolor{green}{Advantages}: 
            \begin{itemize}
                \item[-] contribution to Bitcoin security
                \item[-] more security (full node can see all the transactions) 
            \end{itemize}
        \end{itemize}
    \end{block}
  \end{frame}
  
  
  
  
   \begin{frame}{Bitcoin Network}
    \framesubtitle{Node types}
    \begin{block}{2) Miners}
        \begin{itemize}
            \item Nodes that solve the proof-of-work and create new blocks
            \item They compete with each other
            \item They do not necessarily have to be full-nodes
            \begin{itemize}
                \item[\MVRightarrow] they participate to mining pools \footnote{Mining pool = groups of cooperating miners who agree to share block rewards in proportion to their contributed mining hash power} in which a pool server maintain the full copy of the Blockchain
            \end{itemize}
        \end{itemize}
    \end{block}
  \end{frame}
  
  
  
  
  \begin{frame}{Bitcoin Network}
    \framesubtitle{Node types}
    \begin{block}{3) Lightweight clients}
        \begin{itemize}
            \item Clients designed to run on limited resources devices (e.g. smartphones, tablets, etc.) 
            \item They store only the headers of the blocks 
            \item They validate transactions using a Simple Payment Verification (SPV) scheme \footnote{e.g. they have to verify that none of the transaction's inputs have been previously spent}
            \begin{itemize}
                \item[-] they check if a transaction belongs to a block by requesting a Merkle Path to a full node
                \item[-] they validate the proof-of-work of the block
                \item[-] they do not build the UTXO set: they check how deep the block of the transaction is ``buried'' \MVRightarrow many blocks above it = the transaction is valid (e.g. it's not double-spent)
            \end{itemize}
        \end{itemize}
    \end{block}
  \end{frame}
  
  
  
  
  \begin{frame}{Bitcoin Network}
    \framesubtitle{Node types}
    \begin{block}{Lightweight clients drawback}
        \begin{itemize}
            \item They have to trust full nodes (they assume that blocks and transactions are being correctly validated)
            \item They cannot verify that a transaction \emph{does not exist} (they can only verify if it \emph{exists})
            \begin{itemize}
                \item[\MVRightarrow] possibility to double spend a transaction (spend the same UTXOs two times) by hiding to the node the first transaction
                \pause
                \item[\MVRightarrow] \textcolor{green}{Solution}: SPV nodes connect randomly to several nodes (high probability to find one honest node)
            \end{itemize}
        \end{itemize}
    \end{block}
  \end{frame}
  
  
  \subsection{Mining and Consensus}
  \begin{frame}{Mining and Proof of Work}
      \begin{itemize}
          \item Mining = process through which transactions are validated and new blocks are created and added to the Blockchain
          \item A new block is created every 10 minutes 
          \item Miners are rewarded with basecoin + fees
          \item For creating a new block, miners have to solve the \textbf{Proof of Work}
      \end{itemize}
  \end{frame}
  
  
  
  \begin{frame}{Mining and Proof of Work}
      \begin{block}{Proof of Work}
      \begin{center}
          $H(N||Prev\_hash||Tx||Tx||....||Tx)<Target$
      \end{center}
        \begin{itemize}
            \item Hard problem based on cryptographic hash algorithm (SHA-256)
            \item Acts as a proof that the miner spent enough computing effort
            \item The target (difficulty) is always adjusted so that a new block is mined every ~10 minutes
            \item The hash $H$ is actually calculated on the block header
            \item After the block is mined, the node transmits it to its peers
            \begin{itemize}
                \item[\MVRightarrow] the nodes validate and propagate it
            \end{itemize}
        \end{itemize}
      \end{block}
  \end{frame}
  
  
  
  \begin{frame}{Consensus}
    \begin{itemize}
        \item No central authority
        \item \textbf{Emergent consensus}: consensus is not achieved explicitly
        \item Consensus emerges from:
        \begin{enumerate}
            \item independent verification of transactions
            \item aggregation of transaction into blocks and solving of PoW
            \item independent verification of new-mined blocks
        \end{enumerate}
        %\item A transaction is included in a block \MVRightarrow mined at a depth of 1 %\begin{itemize}
        %    \item subsequent block found \MVRightarrow the number of blocks deep is increased by 1
        %\end{itemize}
        \item Classic Bitcoin client:  ``unconfirmed'' until the transaction is 6 blocks deep
    \end{itemize}
  \end{frame}
  
  
  
  
  \begin{frame}{Consensus}
      \begin{block}{Verification of Transactions}
      The node checks:
        \begin{itemize}
            \item syntax of the transaction
            \item neither transaction inputs or outputs are empty
            \item transaction size 
            \item ...
            \item \textbf{for each input, the referenced output must exist and cannot be already spent}
        \end{itemize}
      \end{block}
      After validating a transaction, the node:
      \begin{itemize}
          \item adds it to its memory pool waiting to include it into a block
          \item propagates it to its peers
      \end{itemize}
  \end{frame}
  
  
  \begin{frame}{Consensus}
      \begin{block}{Verification of Blocks}
      The node checks:
        \begin{itemize}
            \item syntax of the block
            \item the hash of the header (check the PoW)
            \item the block size 
            \item the first transaction is a coinbase transaction
            \item ...
            \item \textbf{all transaction within the block are valid}
        \end{itemize}
      \end{block}
      After validating a block, the node propagates it to its peers
      \begin{itemize}
          \item [\MVRightarrow] only valid blocks are propagated through the network
          \item [\MVRightarrow] validation prevents dishonest miners % (e.g. miners that write for themselves an arbitrary amount of bitcoin instead of the correct basecoin reward) they would have their block rejected and they would only waste the PoW effort
      \end{itemize}
  \end{frame}
  
  
  
  \begin{frame}{Consensus}
      \begin{block}{Blockchain Forks}
        \begin{itemize}
            \item Blocks might arrive at different nodes at different times
            \item Nodes have different perspectives of the Blockchain (multiple different ``version'' of the Blockchain
            \item Solution: each nodes always selects the ``longest'' Blockchain % The one with the greatest cumulative work (sum the work recorded in each block)
            \item By doing this, the network eventually converges to a consistent state
        \end{itemize}
      \end{block}
  \end{frame}
  
  
  
  
  \begin{frame}{Consensus}
      \begin{block}{The 51\% attack}
        \begin{itemize}
            \item Vulnerability of the consensus mechanism
            \item Can be carried out by a group of miners controlling more than 50\% of the total hashing power
            \item The attackers can: 
            \begin{itemize}
                \item[-] prevent new transactions from gaining confirmations
                \item[-] reverse completed transactions
            \end{itemize}
            \item Extremely hard to perform, not considered a real threat 
            \begin{itemize}
                \item[\MVRightarrow] it however already happened on other Blockchains (e.g. Verge Blockchain \cite{bitcoinnews2018})
            \end{itemize}
        \end{itemize}
      \end{block}
      Even if carried out, the attackers cannot create new coins or alter old blocks
  \end{frame}
  
  
  
  \begin{frame}{Consensus}
  \framesubtitle{The 51\% attack}
      \begin{figure}
          \centering
          \includegraphics[width=1\linewidth]{../img/attack_1.png}
      \end{figure}
      \begin{figure}
          \centering
          \includegraphics[width=1\linewidth]{../img/attack_2.png}
      \end{figure}
  \end{frame}
  
  
  
  \section{Bitcoin Anonymity}
  \subsection{Anonymity issues}
  \begin{frame}{Anonymity issues}
      \begin{itemize}
          \item Transactions are exchanged between addresses (``pseudonyms'')
          \item Not enough for assuring users privacy: 
          \begin{itemize}
              \item[-] transactions are publicly available
              \item[-] transactions = chain of digital signatures
              \item[-] transactions can be linked together (e.g. through behavior-based analysis): single transaction is linked to the user identity $\rightarrow$ all of his transaction are exposed
          \end{itemize}
          \item Analogy with banks: bank statements publicly available but with blanked names
      \end{itemize}
  \end{frame}
  
  
  
  \begin{frame}{Anonymity issues}
  \framesubtitle{Examples of compromised privacy}
      \begin{enumerate}
          \item \textbf{Exploitation of multi-input transactions}
          \begin{itemize}
              \item multi-input transaction = transaction which accepts more UXTOs as input
              \item input UXTOs owned by different addresses $\rightarrow$ those addresses belong to the same user
          \end{itemize}
          \pause
          \item \textbf{Exploitation of shadow addresses}
          \begin{itemize}
              \item shadow addresses = addresses automatically created for collecting the transactions changes
              \item transaction has $n$ output addresses, only one is a new address $\rightarrow$ the new address is a shadow address for the user that sent the transaction
          \end{itemize}
          \pause
          \item \textbf{Behaviour-based analysis}
          \begin{itemize}
              \item algorithms such as KMC and HAC have been tested in a simulated Bitcoin system \cite{androulaki2013evaluating}
              \item they captured 42\% of the users profiles with an 80\% accuracy
          \end{itemize}
      \end{enumerate}
  \end{frame}
  
  
  
  \begin{frame}{Anonymity issues}
      \begin{block}{Tainted bitcoins}
        \begin{itemize}
            \item history of each bitcoin can be traced
            \item consequence of the lack of anonymity
            \item some bitcoins can be marked as \textbf{tainted}
            \begin{itemize}
                \item users are less likely to accept them $\rightarrow$ deflation of their value
            \end{itemize}
        \end{itemize}
      \end{block}
  \end{frame}
  
  
  
  
  \begin{frame}{Enhancing Bitcoin Anonymity}
      How to enhance Bitcoin anonymity? Two main approaches:
      \begin{enumerate}
          \item Mixing services
          \begin{itemize}
              \item[\MVRightarrow] efficient
              \item[\MVRightarrow] require absolute trust in a third party
          \end{itemize}
          \item Cryptographic extensions of Bitcoin
          \begin{itemize}
              \item[\MVRightarrow] no need to trust third parties
              \item[\MVRightarrow] lower performance
              \item[\MVRightarrow] new cryptocurrencies \footnote{e.g. ZeroCoin \cite{miers2013zerocoin} and ZeroCash \cite{sasson2014zerocash}} or Bitcoin-compatible
          \end{itemize}
      \end{enumerate}
  \end{frame}
  
  
  \subsection{Mixing Services}
  \begin{frame}{Mixing Services}
      \begin{figure}
          \centering
          \includegraphics[width=0.6\linewidth]{../img/mixing-service-scheme.png}
      \end{figure}
      \begin{itemize}
          \item Mediators that transfer payments from an input set of addresses to an output set of addresses
          \item Transfers made in a way that is hard to trace which input addresses paid which output addresses
      \end{itemize}
  \end{frame}
  
  
  
  \begin{frame}{Mixing Services}
      Examples of Mixing Services: 
      \begin{itemize}
          \item Mixcoin
          \begin{itemize}
              \item[-] relies on a single third party \MVRightarrow not so safe (e.g. could potentially steal the bitcoins) 
          \end{itemize}
          \item CoinParty
          \begin{itemize}
              \item[-] relies on more parties
              \item[-] considered secure only if $2/3$ of the parties are honest
          \end{itemize}
      \end{itemize}
  \end{frame}
  
  
  \subsection{Bitcoin-compatible anonymity schemes}
  \begin{frame}{Reference scenario}
      \begin{itemize}
          \item $A$ wants to send 1 bitcoin to $B$ anonymously
          \item if $A$ sends 1 BTC from $address_A$ (owned by $A$) to $address_B$ (owned by $B$) then record in the Blockchain linking the two addresses is created
          \begin{itemize}
              \item[-] links between the addresses can be used to de-anonymize the users
              \item[-] using a new address for each received payment is not enough
          \end{itemize} \pause 
          \item Solution:
          \begin{minipage}{\linewidth}
            \includegraphics[width=0.4\linewidth]{../img/scenario.png}
          \end{minipage}
          \item $I$ breaks the link between $A$ and $B$ addresses
          \begin{itemize}
              \item acts as a mixing service, but we don't want to trust $I$
          \end{itemize}
      \end{itemize}
  \end{frame}
  
  
  
  \begin{frame}{Blind Signatures}
      \begin{itemize}
          \item Introduced by David Chaum in 1982 \cite{chaum1982blind}
          \item Cryptographic primitive that allows to an entity to sign a message without being able to read the message it signs 
          \item Analogy: envelope with carbon paper inside of it 
      \end{itemize}
      
      \pause
      \begin{block}{RSA Blind Signature scheme}
        \begin{itemize}
            \item Blinding factor $b=r^{e}\bmod n$, with $r$ random number
            \item Message $m$ is blinded with $b$: $m_{*}=b\cdot m\bmod n$
            \item $m_*$ sent to the signer. The signer signs it by
          computing $s_*$: \[ s_*=m_*^d\bmod n = b^d\cdot m^d\bmod n = r^{e\cdot d}\cdot m^d \bmod n = r\cdot m^d \bmod n \]
            \item The user can divide $s_*$ by $r$ for retrieving $s=m^d\bmod n$, namely the RSA signature of the message $m$
        \end{itemize}
      \end{block}
  \end{frame}
  
  
  
  \begin{frame}{First scheme: eCash scheme}
      \begin{figure}
          \centering
          \includegraphics[width=0.6\linewidth]{../img/eCash-scheme.png}
      \end{figure}
      \begin{itemize}
          \item Conceived by David Chaum for eCash (an anonymous cryptocurrency) in 1982 \cite{chaum1982blind}
          \item $I$ does not know who $A$ wants to pay \pause
          \item \red{Main problem}: $I$ has to be honest
          \begin{itemize}
              \item[-] a malicious $I$ could refuse to issue a voucher to $A$
          \end{itemize}
          \pause
          \item \textcolor{green}{Solution}: Heilman scheme \cite{heilman-blindly-signed-contracts}
      \end{itemize}
  \end{frame}
  
  
  
  
  \begin{frame}{Second scheme: Heilman scheme}
      \begin{figure}
          \centering
          \includegraphics[width=0.4\linewidth]{../img/heilman-scheme.png}
      \end{figure}
      \begin{itemize}
          \item It uses \emph{transaction contracts} for achieving \emph{fair exchange}
          \begin{itemize}
              \item[\MVRightarrow] \textbf{key idea}: $A$ transfers a bitcoin to $I$ if and only if it received a valid $V$ in return 
          \end{itemize}
          \item It consist of 4 Blockchain transactions (confirmed in 3 blocks) implemented in 2 fair-exchanges
      \end{itemize}
  \end{frame}
  
  
  
  
  \begin{frame}{Second scheme: Heilman scheme (Cont. 1)}
      \begin{figure}
          \centering
          \includegraphics[width=0.4\linewidth]{../img/heilman-scheme.png}
      \end{figure}
      \begin{block}{1) Fair-exchange $V\rightarrow BTC$}
        \begin{itemize}
            \item Interaction between $B$ and $I$
            \item Composed by transactions $T_{offer(V\rightarrow BTC)}$ and $T_{fullfill(V\rightarrow BTC)}$
            \item Ensures that a malicious $I$ cannot redem $B$'s voucher without providing a bitcoin in return
        \end{itemize}
      \end{block}
  \end{frame}
  
  
  
  
  \begin{frame}{Second scheme: Heilman scheme (Cont. 2)}
      \begin{figure}
          \centering
          \includegraphics[width=0.4\linewidth]{../img/heilman-scheme.png}
      \end{figure}
      \begin{block}{2) Fair-exchange $BTC\rightarrow V$}
        \begin{itemize}
            \item Interaction between $A$ and $I$
            \item Composed by transactions $T_{offer(BTC\rightarrow V)}$ and $T_{fullfill(BTC\rightarrow V)}$
            \item Ensures that a malicious $I$ cannot take a bitcoin from $A$ without providing him with a voucher $V$
        \end{itemize}
      \end{block}
  \end{frame}
  
  
  
  \begin{frame}{Second scheme: Heilman scheme (Cont. 3)}
      \begin{block}{Implementation of fair-exchange $BTC\rightarrow V$}
        \begin{itemize}
            \item Implemented through \emph{transaction contracts} (Script)
            \begin{itemize}
                \item[\MVRightarrow] transaction associated with rules that define the rules for spending the transaction outputs
            \end{itemize}
            \item CHECK\_LOCK\_TIME\_VERIFY used to timelock a transaction: if the contract is not spent within $Tw$, then refound 
            \item $A$ generates $T_{offer(BTC\rightarrow V)}$. The output can be spent in a future transaction $T_f$ only if:
            \begin{enumerate}
                \item $T_f$ is signed by $I$ and contains a valid blind signature $\overline\sigma$ on $\overline{sn}$
                \item[] OR 
                \item $T_f$ is signed by $A$ and the time window $Tw$ has expired
            \end{enumerate}
        \end{itemize}
      \end{block}
      \pause
      
      The implementation of fair-exchange $BTC\rightarrow V$ is analogous
  \end{frame}
  
  
  
  
  
  \begin{frame}{Anonymity Considerations}
      \begin{figure}
          \centering
          \includegraphics[width=0.4\linewidth]{../img/epochs.png}
      \end{figure}
      \begin{itemize}
          \item The 4 transactions are confirmed and stored in an epoch
          \item The anonymity depends on the number of payments through $I$ in a given epoch
      \end{itemize}
  \end{frame}
  
  
  
  
  \begin{frame}{Anonymity Considerations (Cont. 1)}
      The following assumptions are made:  
      \begin{enumerate}
          \item the users coordinate in order to respect the epoch transactions arrangement (e.g. starting block with height multiple of 3) 
          \item $A$ and $B$ trust each other 
          \begin{itemize}
              \item[-] if $A$ or $B$ were malicious they could consire with $I$ 
          \end{itemize}
          \item $B$ always receives payments using fresh addresses
          \item payers only make on payment per epoch; payees accept only one payment per epoch
      \end{enumerate}
      \pause
      \begin{block}{}
      Assumptions 2 + 3 \MVRightarrow in each epoch there are $n$ addresses making payments and $n$ addresses receiving payments 
      \begin{itemize}
          \item[\MVRightarrow] $1/n$ of probability of linking a payer $A$ to a payee $B$
      \end{itemize}
      \end{block}
  \end{frame}
  
  
  
  \begin{frame}{Anonymity Considerations (Cont. 2)}
      \begin{itemize}
          \item Users know the size of their anonymity set ($n$) by looking at the blockchain after the transactions complete
          \item What if $B$ feels his $n$ is too small? \pause
          \begin{itemize}
              \item[-] it's assumed that $B$ has been paid on $address_B$
              \item[-] $B$ creates a new ephemeral address $address_B'$
              \item[-] $B$ pays from $address_B$ to $address_B'$ in another epoch
          \end{itemize}
      \end{itemize}
  \end{frame}
  
  
  
  
  
  \section{Bitcoin Scalability}
  \subsection{Overview}
  \begin{frame}{Bitcoin Scalability Overview}
      \begin{itemize}
          \item Increasing adoption of Bitcoin \MVRightarrow ability to scale received a lot of attention 
          \item Main concerns:
          \begin{enumerate}
              \item can blockchain-based cryptocurrencies (like Bitcoin) scale-up and reach the performance of traditional payment processor? 
              \item what does it take to get there? 
          \end{enumerate}
          \pause
          \item Current Bitcoin performance: 
          \begin{itemize}
              \item around 10 min to confirm a transaction 
              \item maximum block size = 1 MB (average size = 800 KB) \cite{current-block-size}
              \item maximum throughput of 7 transactions/sec \cite{wikipedia_scalability_2018}
              \item throughput limited by max block size and block interval
          \end{itemize} \pause
          \item Comparison with Visa credit cards \cite{wikipedia_scalability_2018}:
          \begin{itemize}
              \item 2000 transactions/sec on average
              \item peaks of 56 000 transactions/sec
          \end{itemize}
      \end{itemize}
  \end{frame}
  
  
  
  
  
  \begin{frame}{Bitcoin Scalability Overview}
      \begin{itemize}
          \item Idea for increasing throughput: \textbf{reparametrization}
          \begin{itemize}
              \item[-] decrease blocks interval
              \item[-] increase block maximum size (currently 1 MB)
          \end{itemize}
          \item Great debate
          \begin{itemize}
              \item[\MVRightarrow] \textcolor{red}{Main cons.}: less decentralization
              \item[\MVRightarrow] better to optimize the current block space available 
          \end{itemize}
          \item In \cite{croman-scaling-blockchain}, the author shows that: 
          \begin{itemize}
              \item[-] reparametrization alone cannot address Bitcoin scaling
              \begin{itemize}
                  \item[\MVRightarrow] parameters limitations
                  \item[\MVRightarrow] other bottlenecks in the Bitcoin system
              \end{itemize}
          \end{itemize}
      \end{itemize}
  \end{frame}
  
 
  
  
  
  \subsection{Reparametrization limitations}
  \begin{frame}{Metrics definitions}
      \begin{enumerate}
          \item ``X\% block propagation delay'' = time required for X\% of the nodes to receive a full block
          \begin{itemize}
              \item[\MVRightarrow] it's calculated empirically
          \end{itemize}
          \item $\text{``X\% effective throughput''} = \frac{\text{block size}}{\text{X\% block propagation delay}}$
      \end{enumerate}
      \begin{itemize}
          \item transaction rate $>$ X\% effective throughput $\rightarrow$ (100 -X)\% of the nodes unable to receive blocks as they arrive
      \end{itemize}
  \end{frame} 
  
  
  \begin{frame}{Limits}
    Premises:
    \begin{itemize}
        \item current level of decentralization has to be maintained 
        \begin{itemize}
            \item[\MVRightarrow] at least 90\% of properly working nodes
        \end{itemize}
        \item current Bitcoin peer-to-peer network is used, no changes to it 
        \begin{itemize}
            \item[\MVRightarrow] any change to the network would affect the X\% effective throughput
        \end{itemize}
    \end{itemize}
    
    \begin{block}{Throughput limit}
        \[ \text{90\% block propagation delay} < \text{block interval} \]
        namely 
        \[ \frac{\text{block size}}{\text{90\% effective throughput}} < \text{block interval} \]
        \begin{itemize}
            \item[\MVRightarrow] \footnote{assuming block interval = 10 min} block size not more than 4 MB, e.g max throughput = 27 transactions/sec 
        \end{itemize}
    \end{block}
  \end{frame}
  
  
  
  
  \begin{frame}{Limits (Cont. 1)}
      \begin{block}{Block interval limit}
        \begin{itemize}
            \item Reducing block interval = lower latency 
            \item Reducing block interval \MVRightarrow block size has to be reduced as well (due to throughput limit equation)
            \item Block size too small \MVRightarrow network bandwidth is not fully used
            \item Result of experiments/measurements of \cite{croman-scaling-blockchain}: block interval not smaller then 12 seconds in order to: 
            \begin{itemize}
                \item[-] have at least 90\% effective throughput
                \item[-] fully utilize the network bandwidth 
            \end{itemize}
        \end{itemize}
      \end{block}
  \end{frame}
 
 
 
 
 
  \subsection{Bottleneck analysis}
  \begin{frame}{Network Plane}
      \begin{itemize}
          \item Function: propagate messages corresponding to valid transactions
          \item Bitcoin protocol does not fully use the available bandwidth
          \item Two main inefficiencies: 
          \begin{enumerate}
              \item before propagating a transaction, a node has to fully receive it and validate it (for avoiding Dos)
              \begin{itemize}
                  \item[\MVRightarrow] \textcolor{green}{possible solution}: low-latency broadcast protocols, nodes allowed to rate-limit transmissions from their peers
              \end{itemize}
              \pause
              \item first transactions are propagated (creation of pools), then blocks are propagated: some transactions are transmitted twice
              \begin{itemize}
                  \item[\MVRightarrow] \textcolor{green}{possible solution}: set reconciliation protocol (single transactions pools are similar) 
              \end{itemize}
          \end{enumerate}
      \end{itemize}
  \end{frame}
  
  
  
  \begin{frame}{Consensus Plane}
      \begin{itemize}
          \item Function: mining and achieving consensus
          \item Limitation: Proof of Work 
          \begin{itemize}
              \item[-] tradeoff between consensus speed, bandwidth and security
          \end{itemize}
          \item \textcolor{green}{Possible solution}: different consensus mechanism (e.g. Proof of Stake) 
      \end{itemize}
  \end{frame}
  
  
  
  
  \begin{frame}{Storage Plane}
      \begin{itemize}
          \item Function: store the Bitcoin ledger and support \texttt{read} and \texttt{write} operations
          \item Main issue: each node stores a copy of the entire Blockchain
          \begin{itemize}
              \item[-] in June 2018 it was 178 GB \cite{statista}
              \item[-] it grows exponentially
          \end{itemize}
      \end{itemize}
  \end{frame}
  
  
  
  
  \begin{frame}{View Plane}
      \begin{itemize}
          \item Function: allows miners to mine without storing the full copy of the Blockchain
          \begin{itemize}
              \item[-] they operate on a \emph{view} of the ledger: UTXO set
              \item[-] UTXO set specifies the current balance of all the entities
              \item[-] UTXO set has to be computed
          \end{itemize}
          \item Main issue: computing the view takes a lot of time \item \textcolor{green}{Possible solution}: storing the view in the Storage Plane 
      \end{itemize}
  \end{frame}
  
  
  
  
  \section{Conclusions}
  \begin{frame}{Contents}
      \frametitle{\contentsname}
    \begin{multicols}{2}
        \tableofcontents[currentsection,currentsubsection]
    \end{multicols}
  \end{frame}
  
  
  
  \begin{frame}{Conclusions}
      \begin{itemize}
          \item 
      \end{itemize}
  \end{frame}
  
  
  
  
  


  \begin{frame}[allowframebreaks]{References}
    \printbibliography
  \end{frame}

\end{document}
